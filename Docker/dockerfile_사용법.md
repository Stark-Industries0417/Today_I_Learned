## Dockerfile 이란

- docker 이미지를 작성할 수 있는 기능
- dockerfile 문법으로 이미지 생성을 위한 스크립트를 작성할 수 있고, 이를 기반으로 이미지 생성 가능
- 나만의 이미지 생성할 수 있고, 배포를 위해서도 많이 활용하는 기능

## Dockerfile 기본 문법

- Dockerfile 은 텍스트 파일 형식, 각자 사용하는 어떤 에디터로든 작성 가능
- 명령과 인자로 이뤄짐
- 명령은 통상적으로 대문자로 작성, 소문자도 관계없지만 명령임을 구별하기 위해 대문자로 작성

## Dockerfile 주요 명령

| 명령       | 설명                                                                                                                             |
| ---------- | -------------------------------------------------------------------------------------------------------------------------------- |
| FROM       | 베이스 이미지 지정 명령(ex: FROM httpd:alpine)                                                                                   |
| LABEL      | 버전 정보, 작성자와 같은 이미지 설명 작성 위한 명령 (ex: LABEL version="1.0.0")                                                  |
| CMD        | docker 컨테이너 시작할 때, 실행하는 쉘 명령을 지정하는 명령(ex: CMD ['python', 'app.py'])                                        |
| RUN        | 쉘 명령 실행하는 명령(ex: RUN ["apt-get", "install", "nginx"]) RUN은 이미지 작성 시 실행, 일종의 새로운 이미지 layer 만드는 역할 |
| ENTRYPOINT | 컨테이너 시작할 때, 실행하는 쉘 명령 지정하는 명령 CMD 명령을 덮음                                                               |
| EXPOSE     | 컨테이너 외부에 오픈할 포트 설정(ex: EXPORT 8080)                                                                                |
| ENV        | 컨테이너 내부에서 사용할 환경 변수 지정(ex: ENV PATH /usr/bin:$PATH)                                                             |
| WORKDIR    | 컨테이너에서의 작업 디렉토리 설정                                                                                                |
| COPY       | 파일 또는 디렉토리 컨테이너에 복사, ADD 와 달리 URL 지정 불가, 압출 파일을 자동으로 풀어주지 않음(ex: COPY test.sh/root/test.sh) |

## Dockerfile 이미지 작성

```docker
docker build 옵션 Dockerfile_경로
```

| 옵션        | 설명                                                                                                                                                                                                                                                                                                    |
| ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| -t or --tag | 이미지 이름 설정. 이름은 저장소(Dockerhub ID)/이미지이름: 태그와같이 작성 가능                                                                                                                                                                                                                          |
| -f          | 이미지 빌드 시 디폴트로 dockerfile 파일명으로 된 파일 찾아서 이미지 빌드 진행. 그 외의 파일명으로 이미지 빌드할 경우 사용하는 옵션                                                                                                                                                                      |
| --pull      | FROM 으로 지정된 이미지는 한번 다운로드 받으면 이미지 생성시 마다 새로 다운로드 받지 않고 받은 이미지 사용함. 해당 옵션은 이미지 생성시 마다 새로 다운로드 받으라는 옵션 (ex --pull=true) dockerHub에 베이스 이미지를 수시로 업데이트하고, 이를 기반으로 새로운 이미지 생성 시 자주 사용할 수 있는 옵션 |

```docker
# 이미지 이름 test로 설정 -> 디폴트 태그가 붙어서 test:latest 로 작성됨 마지막 . 은 현재 폴더 의미
docker build --tag test .
```

```
docker build --tag test2 -f test_dockerfile .
```

### LABEL

- <key>=<value> 형식으로 메타 데이터 넣을 수 있는 기능
- 보통 저자, 버전, 설명, 작성일자 등을 각가 key 이름을 정하고 값을 넣는다

```
FROM alpine
LABEL maintainer='~~@naver.com'
LABEL version='1.0.0'
LABEL description='A test docker image to understand docker'
```

### COPY

```
# 호스트 PC의 2021_DEV 폴더내의 모든것을 컨테이너 폴더로 복사
COPY ./2021_DEV /usr/local/apache2/htdocs
```

### CMD

```
# CMD는 하나의 Dockerfile 에서 한 가지만 설정됨, CMD 설정 여러개일 경우, 맨 마지막에 설정된 CMD 설정만 적용
CMD ["/bin/sh", "-c", "echo", "Hello"]
```
