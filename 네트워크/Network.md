# 목차

- [OSI 7계층](#osi-7계층)

  - [OSI 7계층을 나누는 이유](#osi-7계층을-나누는-이유)
  - [OSI 7계층](#osi-7계층)
  - [물리 계층](#물리-계층)
  - [데이터 링크 계층](#데이터-링크-계층)
  - [네트워크 계층](#네트워크-계층)
  - [전송 계층](#전송-계층)
  - [세션 계층](#세션-계층)
  - [표현 계층](#표현-계층)
  - [응용 계층](#응용-계층)

- [TCP](#tcp)
  - [TCP란](#tcp란)
  - [TCP의 특징](#tcp의-특징)
  - [오류제어](#오류제어)
  - [재전송 되는 경우](#재전송-되는-경우)
  - [혼잡 제어](#혼잡-제어)
  - [혼잡 회피](#혼잡-회피)
  - [빠른 회복](#빠른-회복)
  - [빠른 재전송](#빠른-재전송)

# OSI 7계층

## OSI 7계층을 나누는 이유

- 표준화를 통해 이질적인 포트 문제나 프로토콜 등으로 인한 문제를 해결하여 비용 절감
- 계층별의 기능과 통신 과정을 단계별로 나눠 쉽게 알 수 있고 특정한 곳에 이상 생기면 그 단계만 수정할 수 있기 때문

## OSI 7계층

- 이 모델은 프로토콜을 기능별로 나눈 것
- 각 계층은 하위 계층의 기능만을 이용하고, 상위 계층에게 기능 제공
- 프로토콜 스택, 스택은 이러한 계층들로 구성된 프로토콜 시스템이 구현된 시스템을 가리킨다

## 물리 계층

> 리피터, 케이블, 허브 등

- 전송 단위는 bit 이다.
- 주로 전기적, 기계적, 기능적 특성을 이용해 통신 케이블로 데이터 전송 역할
- 단지 데이터를 전기적 신호로 변화해서 주고받는 기능을 진행하는 공간
  데이터를 전송하는 역할만 진행.

## 데이터 링크 계층

- 물리 계층 통해 송수신 되는 정보의 오류와 흐름 관리하여 안전한 정보의 전달 수행할 수 있도록 도와주는 역할
- MAC 주소 이용해 통신
- Frame에 MAC 주소를 부여하고 에러검출, 재전송, 흐름 제어 진행

## 네트워크 계층

- 여러개 노드를 거칠 때마다 경로 찾아주는 역할 하며, 다양한 길이의 데이터를 목적지까지 가장 안전하고 빠르게 전달하는 기능 담당
- 라우터 통해 이동할 경로 선택하여 IP주소 지정하고, 해당 경로에 따라 패킷 전달
- 라우팅, 흐름제어, 오류제어, 세그먼테이션 등 수행
- 전송 단위는 데이터그램(packet) 이다.

## 전송 계층

- TCP, UDP 프로토콜 통해 통신 활성화, 포트 열어두고 프로그램들이 전송 할 수 있도록 제공해준다. 이를 통해 양 끝단의 사용자들이 데이터 주고 받을 수 있다.
- TCP: 신뢰성, 연결지향적
- UDP: 비신뢰성, 비연결성, 실시간
- 데이터 단위는 Segment이다

## 세션 계층

> API, Socket

- 양 끝단의 응용 프로세스가 통신 관리하기 위한 방법 제공
- 데이터 통신 위한 논리적 연결 담당
- TCP/IP 세션을 만들고 없애는 책임 지니고 있음

## 표현 계층

- 데이터 표현에 대한 독립성 제공하고 암호화 역할 담당
- 파일 인코딩, 명령어를 포장, 압축 암호화 한다.

## 응용 계층

> HTTP, FTP, DNS 등

- 응용 프로세스와 직접 관계하여 일반적인 응용 서비스를 수행
- 일반적인 응용 서비스는 관련된 응용 프로세스들 사이의 전환 제공

[돌아가기](#목차)

# TCP

## TCP란

> TCP는 네트워크 계층 중 전송계층에서 사용하는 프로토콜 로서, 장치들 사이에 논리적인 접속을 성립하기 위하여 연결을 설정하여 신뢰성 보장하는 연결형 서비스

## TCP의 특징

- 인터넷 상에서 데이터를 세그먼트 라는 블록 단위로 보내기 이ㅜ해 IP와 함께 사용하는 프로토콜이다.
  - TCP와 IP를 함께 사용하는데 IP가 데이터의 배달을 처리한다면 TCP는 패킷을 추적 및 관리한다.
- 연결형 서비스로 가상 회선 방식 제공
  - 3-way handshaking과정 통해 연결 설정하고, 4-way handshaking 통해 연결 해제한다.
- 흐름제어 및 혼잡제어 제공
  - 흐름제어
    - 데이터 송신하는 곳과 수신하는 곳의 데이터 처리 속도 조절하여 수신자의 버퍼 오버플로우 방지
    - 송신하는 곳에서 감당이 안되게 많은 데이터를 빠르게 보내 수신하는 곳에서 문제가 일어나는 것을 막는다.
  - 혼잡제어
    - 네트워크 내의 패킷 수가 넘치게 증가하지 않도록 방지하는 것
    - 정보의 소통량이 과다하면 패킷을 조금만 전송하여 혼잡 붕괴 현상 일어나는 것을 막음
- 높은 신뢰성 보장
- UDP보다 속도가 느림
- 전이중, 점대점 방식이다.
  - 전이중: 전송이 양방향으로 동시에 일어날 수 있음
  - 점대점: 각 연결이 정확히 2개의 종단점을 가지고 있음
- 연속성보다 신뢰성 있는 전송이 중요할 때에 사용
- TCP가 가상회선 방식 제공한다는 것은 송신측과 수신측을 연결하여 패킷 전송하기 위한 논리적 경로 배정한다는 뜻

## 오류제어

1. stop and wait ARQ

- 송신측에서 1개의 프레임 송신 -> 수신측에서 수신된 프레임의 에러 유무 판당네 따라 ACK or NAK를 보내는 방식
- 식별 위해 데이터 프레임과 ACK 프레임은 각각 0, 1 번호를 번갈아 부여
- 수신측이 데이터 받지 못했을 경우, NAK 보내고 NAK 받은 송신은 데이터 재전송
- 만약 데이터나 ACK 분실되었을 경우 일정 간격의 시간을 두어 타임아웃이 되면, 송신측은 데이터를 재전송한다.

2. Go-Back-n ARQ(슬라이딩 윈도우)

- 전송된 프레임 손상되거나 분실된 경우 or ACK 패킷 손실로 인한 TIME_OUT 발생한 경우, 확인된 마지막 프레임 이후로 모든 프레임 재전송한다.
- 슬라이딩 윈도우는 연속적인 프레임 전송 기법으로 전송측은 전송된 모든 프레임의 복사본 가지고 있어야 하며, ACK와 NAK 모두 각각 구별해야 한다
  ACK: 다음 프레임 전송
  NAK: 손상된 프레임 자체 번호를 반환

## 재전송 되는 경우

1. NAK 프레임 받았을 경우

- 수신측으로 0 ~ 5 데이터 보냄
- 수신측에서 데이터 받고 ACK 프레임 중간 중간 보냄 -> ACK 프레임 확인한 전송측은 계속해서 데이터 전송
- 만약 수신측에서 데이터 오류가 난 프레임2를 발견하고 NAK2를 전송측에 보냄
- NAK2 받은 전송측은 프레임2 재전송
- GBn ARQ의 특징은 데이터를 재전송 하는 부분이다. **NAK(n) 받아 n 데이터 이후의 모든 데이터를 재전송한다.**

2. 전송 데이터 프레임의 분실

- GBn ARQ의 특징은 확인된 데이터 이후의 모든 데이터 프레임 재전송과 수신측의 폐기이다.
- 수신측에서 데이터 1, 3 을 받으면 2를 못받았으므로 데이터 3 폐기하고 NAK2를 보낸다.
- NAK을 받은 전송측은 데이터2 부터 모든 데이터 재전송한다.

3. 지정된 타임아웃 내의 ACK 프레임 분실

- 전송측은 분실된 ACK 다루기 위해 타이머 가지고 있음
- 전송측에서는 타임아웃 동안 수신측으로부터 ACK 데이터 받지 못했을 경우 마지막 ACK된 데이터부터 재전송

3. SR(Selective-Reject) ARQ

- GBn ARQ의 확인된 마지막 프레임 이후의 모든 프레임을 재전송하는 단점 보완한 기법
- SR ARQ는 손상된, 손실된 프레임만 재전송
- 그래서 별도의 데이터 재정렬 수행해야 하고 별도의 버퍼 필요
- 수신측에 버퍼를 두어 받은 데이터 정렬 필요

## 혼잡 제어

> 송신측의 데이터 전달과 네트워크의 데이터 처리 속도를 해결하기 위한 기법

- 한 라우터에게 데이터가 몰려 모든 데이터를 처리할 수 없는 경우 호스트들은 재전송을 하게되 결국 혼잡을 가중시키고 오버플로우나 데이터 손실 발생
- 이런 네트워크 혼잡 피하기 위해 송신측에서 보내는 데이터 전송 속도 제어하는 것이 혼잡제어의 개념이다.

1. AIMD(Additive Increase Multicative Decrease)

- 합 증가/곱 감소 알고리즘이라 한다.
- 처음에 패킷 하나 보내서 문제없다면 Window size를 1씩 증가시키며 전송하는 방법, 패킷 전송 실패 or TIMEOUT 발생 시 Window Size 절반으로 감소
- 여러 호스트가 한 네트워크 공유하고 있으면 나중에 진입하는 쪽이 불리하지만 시간이 흐르면 평형 상태로 수렴하게 된다.
- 문제점은 초기 네트워크의 높은 대역폭을 사용하지 못하고 네트워크가 혼잡해지는 상황을 미리 감지하지 못하여 혼잡해지고 나서야 대역폭을 줄이는 방식이다.

2. Slow Start

- AIMD가 네트워크의 수용량 주변에선 효율적으로 동작하지만 처음에 전송 속도 올리는데 시간이 너무 길다는 단점이 있다.
- Slow Start는 AIMD와 마찬가지로 패킷을 하나씩 보내는 것부터 시작한다.
- 패킷이 문제 없이 도착하면 ACK 패킷마다 window size를 1씩 늘리는 것이다.
- 혼잡 현상 발생하면 window size 1로 떨어뜨림
- 매 전송마다 2배씩 증가하기 때문에 전송되어지는 데이터 크기는 지수함수적으로 증가
- 전송되는 데이터의 크기가 임계 값에 도달하면 혼잡 회피 단계로 넘어감

## 혼잡 회피

- 윈도우의 크기가 임계 값에 도달한 이우엔 데이터 손실 발생 확률 높아짐
- 이를 회피하기 위해 윈도우 크기 선형적으로 1씩 증가시키는 방법
- 수신측으로부터 일정 시간 동안까지 ACK 수신하지 못한 경우
  - 타임아웃 발생: 네트워크 혼잡 발생했다고 인식
    - 윈도우 크기 즉, 세그먼트의 수 1로 감소
    - 동시에 임계값을 패킷 손실이 발생했을 때의 윈도우 크기의 절반으로 줄임

## 빠른 회복

- 혼잡 상태가 되면 window size 1로 줄이지 않고 절반으로 줄이고 선형 증가 시키는 방법
- 빠른 회복 정책까지 적용하면 혼잡 상황 한번 겪고 나서부턴 순수한 AIMD 방식으로 동작

## 빠른 재전송

- 수신측에서 패킷을 받을 때 먼저 도착해야 할 패킷이 도착하지 않고 다음 패킷이 도착한 경우에도 ACK 패킷 보낸다.
- 순서대로 잘 도착한 마지막 패킷의 다음 패킷의 순번을 ACK 패킷에 실어 보냄
- 중간에 패킷 손실되면 송신측에선 순번이 중복된 ACK 패킷 받게된다.
- 이것을 감지하여 문제가 되는 순번의 패킷을 재전송할 수 있음

- 빠른 재전송은 중복된 순번의 패킷을 3개(3 ACK)받으면 재전송한다. 그리고 이런 현상은 약간의 혼잡이 발생한 것으로 간주하여 window size를 절반으로 줄인다.

[돌아가기](#목차)
